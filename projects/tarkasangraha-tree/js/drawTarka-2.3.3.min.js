var root,full_tree,i=0,duration=700,margin={top:20,right:120,bottom:20,left:120},width=3e3-margin.right-margin.left,height=()=>500-margin.top-margin.bottom+15*document.querySelectorAll("g.node").length,tree=d3.layout.tree().size([height(),width]),diagonal=d3.svg.diagonal().projection((function(t){return[t.y,t.x]})),svg=d3.select("body").append("svg").attr("width",width+margin.right+margin.left).attr("height",height()+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");function update(t){tree.size([height(),width]),d3.select("svg").attr("height",height()+margin.top+margin.bottom),root.x0=height()/2;var e=tree.nodes(root).reverse(),n=tree.links(e);e.forEach((function(t){t.y=180*t.depth}));var r=svg.selectAll("g.node").data(e,(function(t){return t.id||(t.id=++i)})),l=r.enter().append("g").attr("class","node").attr("transform",(function(e){return"translate("+t.y0+","+t.x0+")"}));l.append("circle").attr("r",1e-6).style("fill",(function(t){return t._children?1==t.avayava?"rgb(255, 208, 179)":"lightsteelblue":"#fff"})).style("stroke",(function(t){return 1==t.avayava?"chocolate":"steelblue"})).on("click",(t=>{click(t),displayInfo(t)})),l.append("text").attr("x",(function(t){return t.children||t._children?-13:13})).attr("dy","0.35em").attr("text-anchor",(function(t){return t.children||t._children?"end":"start"})).text((t=>t.name)).style("fill-opacity",1e-6).on("click",(t=>{displayInfo(t),click(t)}));var a=r.transition().duration(duration).attr("transform",(function(t){return"translate("+t.y+","+t.x+")"}));a.select("circle").attr("r",10).style("fill",(function(t){return t._children?1==t.avayava?"rgb(255, 208, 179)":"lightsteelblue":"#fff"})),a.select("text").text((t=>t.name)).style("fill-opacity",1);var o=r.exit().transition().duration(duration).attr("transform",(function(e){return"translate("+t.y+","+t.x+")"})).remove();o.select("circle").attr("r",1e-6),o.select("text").style("fill-opacity",1e-6);var d=svg.selectAll("path.link").data(n,(function(t){return t.target.id}));d.enter().insert("path","g").attr("class","link").attr("d",(function(e){var n={x:t.x0,y:t.y0};return diagonal({source:n,target:n})})),d.transition().duration(duration).attr("d",diagonal),d.exit().transition().duration(duration).attr("d",(function(e){var n={x:t.x,y:t.y};return diagonal({source:n,target:n})})).remove(),e.forEach((function(t){t.x0=t.x,t.y0=t.y}))}function hideAllExceptParents(t){document.querySelectorAll("g.node").forEach((e=>{t.id==e.__data__.id?(console.log(e),e.querySelector("text").setAttribute("style","fill-opacity: 1")):1==e.__data__.long?e.querySelector("text").setAttribute("style","fill-opacity: 0"):e.querySelector("text").setAttribute("style","fill-opacity: 1")}))}function click(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null),collapseNodesExcept(t),update(t),update(t)}function expandNodes(){let t=!0;for(;t;)d3.selectAll("g.node").each((e=>{t=!1,e._children&&(e.children=e._children,e._children=null,t=!0),update(e)}))}function collapseNodesExcept(t){d3.selectAll("g.node").each((e=>{t.depth==e.depth&&e.children&&e.id!=t.id&&(e._children=e.children,e.children=null,update(e))}))}function findNestedChild(t,e){if(!t)return null;if(t.name==e)return t;let n=t._children?t._children:t.children;if(!n)return null;for(var i=n.length-1;i>=0;i--)if(r=findNestedChild(n[i],e),r)return r;return null}function changeRoot(){let t=document.getElementById("rootNode").value;update(root=findNestedChild(full_tree,t)),click(root)}function displayInfo(t){console.log(t);const e=document.getElementById("details"),n=["पा-लक्षणम्","पा-वर्णमाला","पा-वृत्तिः","पा-उदा"],r=["pink","blue","yellow","purple"];let i=document.createElement("div");e.innerHTML="",i.innerHTML=t.name+"<br>",i.setAttribute("class","coral rounded sub_info"),e.appendChild(i);for(var l=0;l<n.length;l++)if(t[n[l]]){let i=document.createElement("div");i.setAttribute("class",r[l]+" rounded sub_info"),"पा-लक्षणम्"==n[l]?i.innerHTML+="<span style='opacity: 0.5; font-size: 80%'> लक्षणम् </span>":"पा-उदा"==n[l]?i.innerHTML+="<span style='opacity: 0.5; font-size: 80%'> उदाहरणम् </span>":"पा-वृत्तिः"==n[l]&&(i.innerHTML+="<span style='opacity: 0.5; font-size: 80%'> वृत्तिः </span>"),i.innerHTML+=t[n[l]],e.appendChild(i)}}d3.json("tarka.json",(function(t,e){root=e,full_tree=JSON.parse(JSON.stringify(e)),root.x0=height()/2,root.y0=0,click(root),update(root),displayInfo(root)}));